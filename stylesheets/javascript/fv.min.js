function get_search_params(){if($("#search_past_events:checked").val()){var b="on"}else{var b=""}var a=$("#searchterms").val();var c=$("#event_search select.neighborhood_select option:selected").val();if(c&&c!="none"){var e=$("#event_search select.neighborhood_select option:selected").val()}else{var e=""}return"past_events="+b+"&neighborhood="+e+"&searchterms="+a}function event_search_submit(a){search_params=get_search_params();build_dialog(100,"?"+search_params)}function get_people_search_params(){var a=$("#person_search select.neighborhood_select option:selected").val();if(a&&a!="none"){var b=$("#person_search select.neighborhood_select option:selected").val()}else{var b=""}return"neighborhood="+b}function people_search_submit(){build_dialog(101,"?"+get_people_search_params())}function close_dialog(){$("#generic_dialog").fadeOut("slow",function(){$("#generic_dialog").remove()})}function build_dialog(b,c){switch(b){case 0:var a="/events/ongoing";break;case 1:var a="/events/upcoming";break;case 2:var a="/events/recommended";break;case 3:var a="/events/hosted/volunteer/"+c;break;case 4:var a="/events/past/volunteer/"+c;break;case 5:var a="/events/upcoming/volunteer/"+c;break;case 6:var a="/events/past/category/"+c;break;case 7:var a="/events/upcoming/neighborhood/"+c;break;case 8:var a="/events/past/neighborhood/"+c;break;case 9:var a="/events/past/coordinated/"+c;break;case 10:var a="/events/upcoming/category/"+c;break;case 11:var a="/events/ongoing/neighborhood/"+c;break;case 20:var a="/events/"+c+"/attendees";break;case 21:var a="/team/list";break;case 22:var a="/category/"+c+"/volunteers";break;case 23:var a="/neighborhoods/"+c+"/volunteers_live";break;case 24:var a="/neighborhoods/"+c+"/volunteers_work";break;case 25:var a="/volunteers/"+c+"/team";break;case 100:var a="/events/search"+c;break;case 101:var a="/volunteers/search"+c;break;case 200:var a="/events/"+c+"/volunteer";break}$.get(a,function(e){$("#dialogs").append(e);$(".closedialog").click(close_dialog)})}var mtaTwitterStatusesFilterReplies=false;function fixDate(e){var b=e.split(" ");var c=b.pop();return b.slice(0,3).concat([c]).concat(b.slice(3)).join(" ")}function relativeTime(b){var a=Date.parse(b);var c=(arguments.length>1)?arguments[1]:new Date();var e=parseInt((c.getTime()-a)/1000);if(e<60){return"less than a minute ago"}else{if(e<120){return"about a minute ago"}else{if(e<(45*60)){return(parseInt(e/60)).toString()+" minutes ago"}else{if(e<(90*60)){return"about an hour ago"}else{if(e<(24*60*60)){return"about "+(parseInt(e/3600)).toString()+" hours ago"}else{if(e<(48*60*60)){return"1 day ago"}else{return(parseInt(e/86400)).toString()+" days ago"}}}}}}}function mtaTwitterCallback(e){var g=e[0].user.id;var c="";var f=false;c+="\n<ul>\n";for(var b=0;b<e.length;b++){var a=e[b].text;if(!mtaTwitterStatusesFilterReplies||(a.match(/^@[A-Z0-9_]+/gi)==null)){a=a.replace(/((http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(\/*)(:(\d+))?([A-Z0-9_\/.?~-]*))/gi,'<a href="$1">$1</a>');a=a.replace(/(@([A-Z0-9_]+))/gi,'@<a class="reply" title="$2 on twitter" href="http://twitter.com/$2">$2</a>');c+='<li class="';if(b==0){c+="first"}else{if(b==(e.length-1)){c+="last"}}if(f){c+=" even"}else{c+=" odd"}c+='">';c+=a;c+=' <span class="when"><a href="http://twitter.com/'+e[b].user.screen_name+"/statuses/"+e[b].id+'">'+relativeTime(fixDate(e[b].created_at))+"</a></span></li>\n";f=!f}}c+="</ul>\n";document.getElementById("mtaTwitterbody").innerHTML=c}function calcTime(b,a){d=new Date();utc=d.getTime()+(d.getTimezoneOffset()*60000);return utc+3600000*a}function get_current_date(){return calcTime("seattle",-8)}if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());function load_title(a){document.title="FV - "+a}function load_header(a){if(a!=""){$("#title_block").html("<h1>"+a+"</h1>")}else{$("#title_block").remove()}}function set_active(a){$("#navtabs li").each(function(){if($(this).attr("id")==a+"link"){$(this).addClass("current")}else{$(this).removeClass("current")}});$("#navtabs li a").each(function(){if($(this).attr("id")=="l_"+a){$(this).addClass("current")}else{$(this).removeClass("current")}})}function set_page_loader(a){$(a+" a.fv").each(function(){$(this).click(function(){if($(this).attr("href").search("http://")>-1){var b=$(this).attr("href").substring($(this).attr("href").indexOf("/",7))}else{var b=$(this).attr("href")}$.address.value(b.replace(/^#/,""))});$(this).address(function(){if($(this).attr("href").search("http://")>-1){var b=$(this).attr("href").substring($(this).attr("href").indexOf("/",7))}else{var b=$(this).attr("href")}return b.replace(/^#/,"")})})}(function(a){a.extend(a.fn,{validate:function(b){if(!this.length){b&&b.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var c=a.data(this[0],"validator");if(c){return c}c=new a.validator(b,this[0]);a.data(this[0],"validator",c);if(c.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){c.cancelSubmit=true});this.submit(function(e){if(c.settings.debug){e.preventDefault()}function f(){if(c.settings.submitHandler){c.settings.submitHandler.call(c,c.currentForm);return false}return true}if(c.cancelSubmit){c.cancelSubmit=false;return f()}if(c.form()){if(c.pendingRequest){c.formSubmitted=true;return false}return f()}else{c.focusInvalid();return false}})}return c},valid:function(){if(a(this[0]).is("form")){return this.validate().form()}else{var c=false;var b=a(this[0].form).validate();this.each(function(){c|=b.element(this)});return c}},removeAttrs:function(e){var b={},c=this;a.each(e.split(/\s/),function(f,g){b[g]=c.attr(g);c.removeAttr(g)});return b},rules:function(f,b){var h=this[0];if(f){var e=a.data(h.form,"validator").settings;var j=e.rules;var k=a.validator.staticRules(h);switch(f){case"add":a.extend(k,a.validator.normalizeRule(b));j[h.name]=k;if(b.messages){e.messages[h.name]=a.extend(e.messages[h.name],b.messages)}break;case"remove":if(!b){delete j[h.name];return k}var i={};a.each(b.split(/\s/),function(l,m){i[m]=k[m];delete k[m]});return i}}var g=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(h),a.validator.classRules(h),a.validator.attributeRules(h),a.validator.staticRules(h)),h);if(g.required){var c=g.required;delete g.required;g=a.extend({required:c},g)}return g}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(b.value)},filled:function(b){return !!a.trim(b.value)},unchecked:function(b){return !b.checked}});a.format=function(b,c){if(arguments.length==1){return function(){var e=a.makeArray(arguments);e.unshift(b);return a.format.apply(this,e)}}if(arguments.length>2&&c.constructor!=Array){c=a.makeArray(arguments).slice(1)}if(c.constructor!=Array){c=[c]}a.each(c,function(e,f){b=b.replace(new RegExp("\\{"+e+"\\}","g"),f)});return b};a.validator=function(b,c){this.settings=a.extend({},a.validator.defaults,b);this.currentForm=c;this.init()};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(b){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass);this.errorsFor(b).hide()}},onfocusout:function(b){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b)}},onkeyup:function(b){if(b.name in this.submitted||b==this.lastElement){this.element(b)}},onclick:function(b){if(b.name in this.submitted){this.element(b)}},highlight:function(c,b){a(c).addClass(b)},unhighlight:function(c,b){a(c).removeClass(b)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",dateDE:"Bitte geben Sie ein gültiges Datum ein.",number:"Please enter a valid number.",numberDE:"Bitte geben Sie eine Nummer ein.",digits:"Please enter only digits",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.format("Please enter no more than {0} characters."),minlength:a.format("Please enter at least {0} characters."),rangelength:a.format("Please enter a value between {0} and {1} characters long."),range:a.format("Please enter a value between {0} and {1}."),max:a.format("Please enter a value less than or equal to {0}."),min:a.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=(this.groups={});a.each(this.settings.groups,function(f,g){a.each(g.split(/\s/),function(i,h){b[h]=f})});var e=this.settings.rules;a.each(e,function(f,g){e[f]=a.validator.normalizeRule(g)});function c(g){var f=a.data(this[0].form,"validator");f.settings["on"+g.type]&&f.settings["on"+g.type].call(f,this[0])}a(this.currentForm).delegate("focusin focusout keyup",":text, :password, :file, select, textarea",c).delegate("click",":radio, :checkbox",c);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var b=0,c=(this.currentElements=this.elements());c[b];b++){this.check(c[b])}return this.valid()},element:function(c){c=this.clean(c);this.lastElement=c;this.prepareElement(c);this.currentElements=a(c);var b=this.check(c);if(b){delete this.invalid[c.name]}else{this.invalid[c.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return b},showErrors:function(c){if(c){a.extend(this.errorMap,c);this.errorList=[];for(var b in c){this.errorList.push({message:c[b],element:this.findByName(b)[0]})}this.successList=a.grep(this.successList,function(e){return !(e.name in c)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm()}this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var c=0;for(var b in e){c++}return c},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus()}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(c){return c.element.name==b.name}).length==1&&b},elements:function(){var c=this,b={};return a([]).add(this.currentForm.elements).filter(":input").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&c.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!c.objectLength(a(this).rules())){return false}b[this.name]=true;return true})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.formSubmitted=false;this.currentElements=a([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b)},check:function(c){c=this.clean(c);if(this.checkable(c)){c=this.findByName(c.name)[0]}var i=a(c).rules();var f=false;for(method in i){var h={method:method,parameters:i[method]};try{var b=a.validator.methods[method].call(this,c.value.replace(/\r/g,""),c,h.parameters);if(b=="dependency-mismatch"){f=true;continue}f=false;if(b=="pending"){this.toHide=this.toHide.not(this.errorsFor(c));return}if(!b){this.formatAndAdd(c,h);return false}}catch(g){this.settings.debug&&window.console&&console.log("exception occured when checking element "+c.id+", check the '"+h.method+"' method");throw g}}if(f){return}if(this.objectLength(i)){this.successList.push(c)}return true},customMetaMessage:function(b,e){if(!a.metadata){return}var c=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return c&&c.messages&&c.messages[e]},customMessage:function(c,e){var b=this.settings.messages[c];return b&&(b.constructor==String?b:b[e])},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b]}}return undefined},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customMetaMessage(b,c),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(b,e){var c=this.defaultMessage(b,e.method);if(typeof c=="function"){c=c.call(this,e.parameters,b)}this.errorList.push({message:c,element:b});this.errorMap[b.name]=c;this.submitted[b.name]=c},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parents(this.settings.wrapper))}return b},defaultShowErrors:function(){for(var c=0;this.errorList[c];c++){var b=this.errorList[c];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass);this.showLabel(b.element,b.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var c=0;this.successList[c];c++){this.showLabel(this.successList[c])}}if(this.settings.unhighlight){for(var c=0,e=this.validElements();e[c];c++){this.settings.unhighlight.call(this,e[c],this.settings.errorClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(c,e){var b=this.errorsFor(c);if(b.length){b.removeClass().addClass(this.settings.errorClass);b.attr("generated")&&b.html(e)}else{b=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(c),generated:true}).addClass(this.settings.errorClass).html(e||"");if(this.settings.wrapper){b=b.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(b).length){this.settings.errorPlacement?this.settings.errorPlacement(b,a(c)):b.insertAfter(c)}}if(!e&&this.settings.success){b.text("");typeof this.settings.success=="string"?b.addClass(this.settings.success):this.settings.success(b)}this.toShow=this.toShow.add(b)},errorsFor:function(b){return this.errors().filter("[for='"+this.idOrName(b)+"']")},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name)},checkable:function(b){return/radio|checkbox/i.test(b.type)},findByName:function(b){var c=this.currentForm;return a(document.getElementsByName(b)).map(function(e,f){return f.form==c&&f.name==b&&f||null})},getLength:function(c,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length}}return c.length},depend:function(c,b){return this.dependTypes[typeof c]?this.dependTypes[typeof c](c,b):true},dependTypes:{"boolean":function(c,b){return c},string:function(c,b){return !!a(c,b.form).length},"function":function(c,b){return c(b)}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true}},stopRequest:function(b,c){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[b.name];if(c&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit()}else{if(!c&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this])}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",previous={old:null,valid:true,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,c){b.constructor==String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(c){var e={};var b=a(c).attr("class");b&&a.each(b.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(e,a.validator.classRuleSettings[this])}});return e},attributeRules:function(c){var f={};var b=a(c);for(method in a.validator.methods){var e=b.attr(method);if(e){f[method]=e}}if(f.maxlength&&/-1|2147483647|524288/.test(f.maxlength)){delete f.maxlength}return f},metadataRules:function(b){if(!a.metadata){return{}}var c=a.data(b.form,"validator").settings.meta;return c?a(b).metadata()[c]:a(b).metadata()},staticRules:function(c){var e={};var b=a.data(c.form,"validator");if(b.settings.rules){e=a.validator.normalizeRule(b.settings.rules[c.name])||{}}return e},normalizeRules:function(c,b){a.each(c,function(g,f){if(f===false){delete c[g];return}if(f.param||f.depends){var e=true;switch(typeof f.depends){case"string":e=!!a(f.depends,b.form).length;break;case"function":e=f.depends.call(b,b);break}if(e){c[g]=f.param!==undefined?f.param:true}else{delete c[g]}}});a.each(c,function(e,f){c[e]=a.isFunction(f)?f(b):f});a.each(["minlength","maxlength","min","max"],function(){if(c[this]){c[this]=Number(c[this])}});a.each(["rangelength","range"],function(){if(c[this]){c[this]=[Number(c[this][0]),Number(c[this][1])]}});if(a.validator.autoCreateRanges){if(c.min&&c.max){c.range=[c.min,c.max];delete c.min;delete c.max}if(c.minlength&&c.maxlength){c.rangelength=[c.minlength,c.maxlength];delete c.minlength;delete c.maxlength}}if(c.messages){delete c.messages}return c},normalizeRule:function(c){if(typeof c=="string"){var b={};a.each(c.split(/\s/),function(){b[this]=true});c=b}return c},addMethod:function(b,e,c){a.validator.methods[b]=e;a.validator.messages[b]=c;if(e.length<3){a.validator.addClassRules(b,a.validator.normalizeRule(b))}},methods:{required:function(e,c,f){if(!this.depend(f,c)){return"dependency-mismatch"}switch(c.nodeName.toLowerCase()){case"select":var b=a("option:selected",c);return b.length>0&&(c.type=="select-multiple"||(a.browser.msie&&!(b[0].attributes.value.specified)?b[0].text:b[0].value).length>0);case"input":if(this.checkable(c)){return this.getLength(e,c)>0}default:return a.trim(e).length>0}},remote:function(g,c,h){if(this.optional(c)){return"dependency-mismatch"}var e=this.previousValue(c);if(!this.settings.messages[c.name]){this.settings.messages[c.name]={}}this.settings.messages[c.name].remote=typeof e.message=="function"?e.message(g):e.message;h=typeof h=="string"&&{url:h}||h;if(e.old!==g){e.old=g;var b=this;this.startRequest(c);var f={};f[c.name]=g;a.ajax(a.extend(true,{url:h,mode:"abort",port:"validate"+c.name,dataType:"json",data:f,success:function(j){if(j){var i=b.formSubmitted;b.prepareElement(c);b.formSubmitted=i;b.successList.push(c);b.showErrors()}else{var k={};k[c.name]=j||b.defaultMessage(c,"remote");b.showErrors(k)}e.valid=j;b.stopRequest(c,j)}},h));return"pending"}else{if(this.pending[c.name]){return"pending"}}return e.valid},minlength:function(c,b,e){return this.optional(b)||this.getLength(a.trim(c),b)>=e},maxlength:function(c,b,e){return this.optional(b)||this.getLength(a.trim(c),b)<=e},rangelength:function(e,b,f){var c=this.getLength(a.trim(e),b);return this.optional(b)||(c>=f[0]&&c<=f[1])},min:function(c,b,e){return this.optional(b)||c>=e},max:function(c,b,e){return this.optional(b)||c<=e},range:function(c,b,e){return this.optional(b)||(c>=e[0]&&c<=e[1])},email:function(c,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(c)},url:function(c,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c)},date:function(c,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(c))},dateISO:function(c,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(c)},dateDE:function(c,b){return this.optional(b)||/^\d\d?\.\d\d?\.\d\d\d?\d?$/.test(c)},number:function(c,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(c)},numberDE:function(c,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:\.\d{3})+)(?:,\d+)?$/.test(c)},digits:function(c,b){return this.optional(b)||/^\d+$/.test(c)},creditcard:function(g,c){if(this.optional(c)){return"dependency-mismatch"}if(/[^0-9-]+/.test(g)){return false}var h=0,f=0,b=false;g=g.replace(/\D/g,"");for(n=g.length-1;n>=0;n--){var e=g.charAt(n);var f=parseInt(e,10);if(b){if((f*=2)>9){f-=9}}h+=f;b=!b}return(h%10)==0},accept:function(c,b,e){e=typeof e=="string"?e:"png|jpe?g|gif";return this.optional(b)||c.match(new RegExp(".("+e+")$","i"))},equalTo:function(c,b,e){return c==a(e).val()}}})})(jQuery);(function(c){var b=c.ajax;var a={};c.ajax=function(f){f=c.extend(f,c.extend({},c.ajaxSettings,f));var e=f.port;if(f.mode=="abort"){if(a[e]){a[e].abort()}return(a[e]=b.apply(this,arguments))}return b.apply(this,arguments)}})(jQuery);(function(a){a.each({focus:"focusin",blur:"focusout"},function(c,b){a.event.special[b]={setup:function(){if(a.browser.msie){return false}this.addEventListener(c,a.event.special[b].handler,true)},teardown:function(){if(a.browser.msie){return false}this.removeEventListener(c,a.event.special[b].handler,true)},handler:function(f){arguments[0]=a.event.fix(f);arguments[0].type=b;return a.event.handle.apply(this,arguments)}}});a.extend(a.fn,{delegate:function(e,c,b){return this.bind(e,function(f){var g=a(f.target);if(g.is(c)){return b.apply(g,arguments)}})},triggerEvent:function(b,c){return this.triggerHandler(b,[a.event.fix({type:b,target:c})])}})})(jQuery);(function(a){a.address=(function(){var c=function(i){a(this).trigger(a.extend(a.Event(i),(function(){var aj={value:this.value(),path:this.path(),pathNames:this.pathNames(),parameterNames:this.parameterNames(),parameters:{},queryString:this.queryString()};for(var ai=0,p=aj.parameterNames.length;ai<p;ai++){aj.parameters[aj.parameterNames[ai]]=this.parameter(aj.parameterNames[ai])}return aj}).call(this)))};var X=function(){c.call(a.address,"init")};var r=function(){c.call(a.address,"change")};var R=function(){var i=W.href.indexOf("#");return i!=-1?ag(s(W.href.substr(i+1))):""};var j=function(){try{return top.document!=undefined?top:window}catch(i){return window}};var H=function(p,i){if(E.strict){p=i?(p.substr(0,1)!="/"?"/"+p:p):(p==""?"/":p)}return p};var t=function(i,p){return(k&&W.protocol=="file:")?(p?S.replace(/\?/,"%3F"):S.replace(/%253F/,"?")):i};var ah=function(ak){for(var ai=0,p=ak.childNodes.length,aj;ai<p;ai++){if(ak.childNodes[ai].src){m=String(ak.childNodes[ai].src)}if(aj=ah(ak.childNodes[ai])){return aj}}};var Z=function(){if(!v){var p=R();var i=!(S==p);if(w&&u<523){if(G!=aa.length){G=aa.length;if(typeof B[G-1]!=I){S=B[G-1]}V(false)}}else{if(k&&u<7&&i){W.reload()}else{if(i){S=p;V(false)}}}}};var V=function(i){r();if(i){c.call(a.address,"internalChange")}else{c.call(a.address,"externalChange")}q(y,10)};var y=function(){var p=(W.pathname+(/\/$/.test(W.pathname)?"":"/")+F.value()).replace(/\/\//,"/").replace(/^\/$/,"");var i=window[E.tracker];if(typeof i==h){i(p)}else{if(typeof pageTracker!=I&&typeof pageTracker._trackPageview==h){pageTracker._trackPageview(p)}else{if(typeof urchinTracker==h){urchinTracker(p)}}}};var f=function(){var i=g.contentWindow.document;i.open();i.write("<html><head><title>"+ae.title+"</title><script>var "+z+' = "'+R()+'";<\/script></head></html>');i.close()};var P=function(){if(!U){U=D;if(k&&u<8){var i=ae.getElementsByTagName("frameset")[0];g=ae.createElement((i?"":"i")+"frame");if(i){i.insertAdjacentElement("beforeEnd",g);i[i.cols?"cols":"rows"]+=",0";g.src="javascript:false";g.noResize=true;g.frameBorder=g.frameSpacing=0}else{g.src="javascript:false";g.style.display="none";ae.body.insertAdjacentElement("afterBegin",g)}q(function(){a(g).bind("load",function(){var p=g.contentWindow;var ai=p.location.href;S=(typeof p[z]!=I?p[z]:"");if(S!=R()){V(false);W.hash=t(S,D)}});if(typeof g.contentWindow[z]==I){f()}},50)}else{if(w){if(u<418){a(ae.body).append('<form id="'+z+'" style="position:absolute;top:-9999px;" method="get"></form>');L=ae.getElementById(z)}if(typeof W[z]==I){W[z]={}}if(typeof W[z][W.pathname]!=I){B=W[z][W.pathname].split(",")}}}q(function(){X();V(false)},1);if(k&&u>=8){ae.body.onhashchange=Z}else{x(Z,50)}a("a[rel*=address:]").address()}};var F={baseURL:function(){var i=W.href;if(i.indexOf("#")!=-1){i=i.substr(0,i.indexOf("#"))}if(i.substr(i.length-1)=="/"){i=i.substr(0,i.length-1)}return i},strict:function(){return E.strict},history:function(){return E.history},tracker:function(){return E.tracker},title:function(){return ae.title},value:function(){if(!ad){return null}return s(H(t(S,ab),ab))},path:function(){var i=this.value();return(i.indexOf("?")!=-1)?i.split("?")[0]:i},pathNames:function(){var p=this.path();var i=p.split("/");if(p.substr(0,1)=="/"||p.length==0){i.splice(0,1)}if(p.substr(p.length-1,1)=="/"){i.splice(i.length-1,1)}return i},queryString:function(){var p=this.value();var i=p.indexOf("?");if(i!=-1&&i<p.length){return p.substr(i+1)}},parameter:function(ao){var al=this.value();var ai=al.indexOf("?");if(ai!=-1){al=al.substr(ai+1);var an=al.split("&");var am,aj=an.length,ak=[];while(aj--){am=an[aj].split("=");if(am[0]==ao){ak.push(am[1])}}if(ak.length!=0){return ak.length!=1?ak:ak[0]}}},parameterNames:function(){var aj=this.value();var p=aj.indexOf("?");var ak=[];if(p!=-1){aj=aj.substr(p+1);if(aj!=""&&aj.indexOf("=")!=-1){var al=aj.split("&");var ai=0;while(ai<al.length){ak.push(al[ai].split("=")[0]);ai++}}}return ak}};var J={strict:function(i){E.strict=i},history:function(i){E.history=i},tracker:function(i){E.tracker=i},title:function(i){i=s(i);q(function(){K=ae.title=i;if(M&&g&&g.contentWindow&&g.contentWindow.document){g.contentWindow.document.title=i;M=ab}if(!O&&ac){W.replace(W.href.indexOf("#")!=-1?W.href:W.href+"#")}O=ab},50)},value:function(ai){ai=ag(s(H(ai,D)));if(ai=="/"){ai=""}if(S==ai){return}O=D;S=ai;v=D;V(true);B[aa.length]=S;if(w){if(E.history){W[z][W.pathname]=B.toString();G=aa.length+1;if(u<418){if(W.search==""){L.action="#"+S;L.submit()}}else{if(u<523||S==""){var i=ae.createEvent("MouseEvents");i.initEvent("click",D,D);var p=ae.createElement("a");p.href="#"+S;p.dispatchEvent(i)}else{W.hash="#"+S}}}else{W.replace("#"+S)}}else{if(S!=R()){if(E.history){W.hash="#"+t(S,D)}else{W.replace("#"+S)}}}if((k&&u<8)&&E.history){q(f,50)}if(w){q(function(){v=ab},1)}else{v=ab}}};var z="jQueryAddress",h="function",I="undefined",D=true,ab=false,C=a.browser,u=parseFloat(a.browser.version),ac=C.mozilla,k=C.msie,N=C.opera,w=C.safari,ad=ab,Q=j(),ae=Q.document,aa=Q.history,W=Q.location,x=setInterval,q=setTimeout,s=decodeURI,ag=encodeURI,af=navigator.userAgent,g,L,m,K=ae.title,G=aa.length,v=ab,U=ab,O=D,M=D,B=[],A={},S=R(),l={},E={history:D,strict:D};if(k){u=parseFloat(af.substr(af.indexOf("MSIE")+4));if(ae.documentMode&&ae.documentMode!=u){u=ae.documentMode!=8?7:8}}ad=(ac&&u>=1)||(k&&u>=6)||(N&&u>=9.5)||(w&&u>=312);if(ad){for(var Y=1;Y<G;Y++){B.push("")}B.push(R());if(k&&W.hash!=R()){W.hash="#"+t(R(),D)}if(N){history.navigationMode="compatible"}ah(document);var b=m.indexOf("?");if(m&&b>-1){var o,e=m.substr(b+1).split("&");for(var Y=0,T;T=e[Y];Y++){o=T.split("=");if(/^(history|strict)$/.test(o[0])){E[o[0]]=(isNaN(o[1])?/^(true|yes)$/i.test(o[1]):(parseInt(o[1])!=0))}if(/^tracker$/.test(o[0])){E[o[0]]=o[1]}}}a(P)}else{if((!ad&&W.href.indexOf("#")!=-1)||(w&&u<418&&W.href.indexOf("#")!=-1&&W.search!="")){ae.open();ae.write('<html><head><meta http-equiv="refresh" content="0;url='+W.href.substr(0,W.href.indexOf("#"))+'" /></head></html>');ae.close()}else{y()}}a.each(("init,change,internalChange,externalChange").split(","),function(ai,p){l[p]=function(aj,i){a(a.address).bind(p,i||aj,i&&aj);return this}});a.each(("strict,history,tracker,title,value").split(","),function(ai,p){l[p]=function(i){if(typeof i!="undefined"){if(ad){J[p](i)}return a.address}else{return F[p]()}}});a.each(("baseURL,path,pathNames,queryString,parameter,parameterNames").split(","),function(ai,p){l[p]=function(i){return F[p](i)}});return l})();a.fn.address=function(b){a(this).click(function(){var c=b?b.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:a(this).attr("href").replace(/^#/,"");a.address.value(c);return false})}}(jQuery));(function($){$.fn.markItUp=function(settings,extraSettings){var options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;options={id:"",nameSpace:"",root:"",previewInWindow:"",previewAutoRefresh:true,previewPosition:"after",previewTemplatePath:"/stylesheets/css/jquery/plugins/markItUp/templates/preview.html",previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);if(!options.root){$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1]}})}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root)}return data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id){id='id="'+options.id+'"'}else{if($$.attr("id")){id='id="markItUp'+($$.attr("id").substr(0,1).toUpperCase())+($$.attr("id").substr(1))+'"'}}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"'}$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true&&$.browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(e){$("html").unbind("mousemove",mouseMove).unbind("mouseup",mouseUp);return false};$("html").bind("mousemove",mouseMove).bind("mouseup",mouseUp)});footer.append(resizeHandle)}$$.keydown(keyPressed).keyup(keyPressed);$$.bind("insertion",function(e,settings){if(settings.target!==false){get()}if(textarea===$.markItUp.focused){markup(settings)}});$$.focus(function(){$.markItUp.focused=this})}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=(button.key)?(button.name||"")+" [Ctrl+"+button.key+"]":(button.name||"");key=(button.key)?'accesskey="'+button.key+'"':"";if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul)}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-"}li=$('<li class="markItUpButton markItUpButton'+t+(i)+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu",function(){return false}).click(function(){return false}).mouseup(function(){if(button.call){eval(button.call)()}markup(button);return false}).hover(function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})},function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");if(altKey===true){return(b[1]!==undefined)?b[1]:b[0]}else{return(b[1]===undefined)?"":b[0]}});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true){return false}value=prompt(b[0],(b[1])?b[1]:"");if(value===null){abort=true}return value});return string}return""}function prepare(action){if($.isFunction(action)){action=action(hash)}return magicMarkups(action)}function build(string){openWith=prepare(clicked.openWith);placeHolder=prepare(clicked.placeHolder);replaceWith=prepare(clicked.replaceWith);closeWith=prepare(clicked.closeWith);if(replaceWith!==""){block=openWith+replaceWith+closeWith}else{if(selection===""&&placeHolder!==""){block=openWith+placeHolder+closeWith}else{block=openWith+(string||selection)+closeWith}}return{block:block,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:(selection||""),caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);if(ctrlKey===true&&shiftKey===true){prepare(clicked.beforeMultiInsert)}$.extend(hash,{line:1});if(ctrlKey===true&&shiftKey===true){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else{lines[i]=""}}string={block:lines.join("\n")};start=caretPosition;len=string.block.length+(($.browser.opera)?n:0)}else{if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len-=fixIeBug(string.block)}else{if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}}}if((selection===""&&string.replaceWith==="")){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else{caretOffset=-1}get();$.extend(hash,{line:"",selection:selection});if(ctrlKey===true&&shiftKey===true){prepare(clicked.afterMultiInsert)}prepare(clicked.afterInsert);prepare(options.afterInsert);if(previewWindow&&options.previewAutoRefresh){refreshPreview()}shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){if($.browser.opera){return string.length-string.replace(/\n*/g,"").length}return 0}function fixIeBug(string){if($.browser.msie){return string.length-string.replace(/\r*/g,"").length}return 0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else{$$.val($$.val().substring(0,caretPosition)+block+$$.val().substring(caretPosition+selection.length,$$.val().length))}}function set(start,len){if(textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&len==0){return false}range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else{if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len)}}textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if($.browser.msie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else{caretPosition=textarea.selectionStart}}else{caretPosition=textarea.selectionStart;selection=$$.val().substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open("","preview",options.previewInWindow)}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=="after"){iFrame.insertAfter(footer)}else{iFrame.insertBefore(header)}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}}else{if(altKey===true){if(iFrame){iFrame.remove()}previewWindow.close();previewWindow=iFrame=false}}if(!options.previewAutoRefresh){refreshPreview()}}function refreshPreview(){if(previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open();previewWindow.document.write(renderPreview());previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp}if(options.previewInWindow){previewWindow.focus()}}function renderPreview(){if(options.previewParserPath!==""){$.ajax({type:"POST",async:false,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(data){phtml=localize(data,1)}})}else{if(!template){$.ajax({async:false,url:options.previewTemplatePath,success:function(data){template=localize(data,1)}})}phtml=template.replace(/<!-- content -->/g,$$.val())}return phtml}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=(!(e.altKey&&e.ctrlKey))?e.ctrlKey:false;if(e.type==="keydown"){if(ctrlKey===true){li=$("a[accesskey="+String.fromCharCode(e.keyCode)+"]",header).parent("li");if(li.length!==0){ctrlKey=false;li.triggerHandler("mouseup");return false}}if(e.keyCode===13||e.keyCode===10){if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else{if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}}}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true){return false}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$$=$(this).unbind().removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$)})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])})}else{$("textarea").trigger("insertion",[options])}}})(jQuery);myHtmlSettings={nameSpace:"html",onShiftEnter:{keepDefault:false,replaceWith:"<br />\n"},onCtrlEnter:{keepDefault:false,openWith:"\n<p>",closeWith:"</p>\n"},onTab:{keepDefault:false,openWith:"     "},previewInWindow:"width=400, height=400, resizable=yes, scrollbars=yes",markupSet:[{name:"Preview",call:"preview",className:"preview"},{separator:"---------------"},{name:"Bold",key:"B",openWith:"<strong>",closeWith:"</strong>"},{name:"Italic",key:"I",openWith:"<em>",closeWith:"</em>"},{name:"Stroke through",key:"S",openWith:"<del>",closeWith:"</del>"},{separator:"---------------"},{name:"Link",key:"L",openWith:'<a href="[![Link:!:http://]!]"(!( title="[![Title]!]")!)>',closeWith:"</a>",placeHolder:"Your text to link..."},{separator:"---------------"},{name:"Paragraph",openWith:'<p(!( class="[![Class]!]")!)>',closeWith:"</p>"},{name:"Heading 1",key:"1",openWith:'<h1(!( class="[![Class]!]")!)>',closeWith:"</h1>",placeHolder:"Your title here..."},{name:"Heading 2",key:"2",openWith:'<h2(!( class="[![Class]!]")!)>',closeWith:"</h2>",placeHolder:"Your title here..."},{name:"Heading 3",key:"3",openWith:'<h3(!( class="[![Class]!]")!)>',closeWith:"</h3>",placeHolder:"Your title here..."},{separator:"---------------"},{name:"Ul",openWith:"<ul>\n",closeWith:"</ul>\n"},{name:"Ol",openWith:"<ol>\n",closeWith:"</ol>\n"},{name:"Li",openWith:"<li>",closeWith:"</li>"}]};(function(f){var b={},l,o,q,k=f.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),a=false;f.tooltip={blocked:false,defaults:{delay:200,fade:false,showURL:true,extraClass:"",top:15,left:15,id:"tooltip"},block:function(){f.tooltip.blocked=!f.tooltip.blocked}};f.fn.extend({tooltip:function(r){r=f.extend({},f.tooltip.defaults,r);i(r);return this.each(function(){f.data(this,"tooltip",r);this.tOpacity=b.parent.css("opacity");this.tooltipText=this.title;f(this).removeAttr("title");this.alt=""}).mouseover(m).mouseout(g).click(g)},fixPNG:k?function(){return this.each(function(){var r=f(this).css("backgroundImage");if(r.match(/^url\(["']?(.*\.png)["']?\)$/i)){r=RegExp.$1;f(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+r+"')"}).each(function(){var s=f(this).css("position");if(s!="absolute"&&s!="relative"){f(this).css("position","relative")}})}})}:function(){return this},unfixPNG:k?function(){return this.each(function(){f(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){f(this)[f(this).html()?"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}});function i(r){if(b.parent){return}b.parent=f('<div id="'+r.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide();if(f.fn.bgiframe){b.parent.bgiframe()}b.title=f("h3",b.parent);b.body=f("div.body",b.parent);b.url=f("div.url",b.parent)}function c(r){return f.data(r,"tooltip")}function h(r){if(c(this).delay){q=setTimeout(p,c(this).delay)}else{p()}a=!!c(this).track;f(document.body).bind("mousemove",e);e(r)}function m(){if(f.tooltip.blocked||this==l||(!this.tooltipText&&!c(this).bodyHandler)){return}l=this;o=this.tooltipText;if(c(this).bodyHandler){b.title.hide();var u=c(this).bodyHandler.call(this);if(u.nodeType||u.jquery){b.body.empty().append(u)}else{b.body.html(u)}b.body.show()}else{if(c(this).showBody){var t=o.split(c(this).showBody);b.title.html(t.shift()).show();b.body.empty();for(var s=0,r;(r=t[s]);s++){if(s>0){b.body.append("<br/>")}b.body.append(r)}b.body.hideWhenEmpty()}else{b.title.html(o).show();b.body.hide()}}if(c(this).showURL&&f(this).url()){b.url.html(f(this).url().replace("http://","")).show()}else{b.url.hide()}b.parent.addClass(c(this).extraClass);if(c(this).fixPNG){b.parent.fixPNG()}h.apply(this,arguments)}function p(){q=null;if((!k||!f.fn.bgiframe)&&c(l).fade){if(b.parent.is(":animated")){b.parent.stop().show().fadeTo(c(l).fade,l.tOpacity)}else{b.parent.is(":visible")?b.parent.fadeTo(c(l).fade,l.tOpacity):b.parent.fadeIn(c(l).fade)}}else{b.parent.show()}e()}function e(u){if(f.tooltip.blocked){return}if(u&&u.target.tagName=="OPTION"){return}if(!a&&b.parent.is(":visible")){f(document.body).unbind("mousemove",e)}if(l==null){f(document.body).unbind("mousemove",e);return}b.parent.removeClass("viewport-right").removeClass("viewport-bottom");var x=b.parent[0].offsetLeft;var w=b.parent[0].offsetTop;if(u){x=u.pageX+c(l).left;w=u.pageY+c(l).top;var s="auto";if(c(l).positionLeft){s=f(window).width()-x;x="auto"}b.parent.css({left:x,right:s,top:w})}var r=j(),t=b.parent[0];if(r.x+r.cx<t.offsetLeft+t.offsetWidth){x-=t.offsetWidth+20+c(l).left;b.parent.css({left:x+"px"}).addClass("viewport-right")}if(r.y+r.cy<t.offsetTop+t.offsetHeight){w-=t.offsetHeight+20+c(l).top;b.parent.css({top:w+"px"}).addClass("viewport-bottom")}}function j(){return{x:f(window).scrollLeft(),y:f(window).scrollTop(),cx:f(window).width(),cy:f(window).height()}}function g(t){if(f.tooltip.blocked){return}if(q){clearTimeout(q)}l=null;var s=c(this);function r(){b.parent.removeClass(s.extraClass).hide().css("opacity","")}if((!k||!f.fn.bgiframe)&&s.fade){if(b.parent.is(":animated")){b.parent.stop().fadeTo(s.fade,0,r)}else{b.parent.stop().fadeOut(s.fade,r)}}else{r()}if(c(this).fixPNG){b.parent.unfixPNG()}}})(jQuery);function handle_notification_message(a){$("#container").append('<div id="dialog" title="Notifications"><p>'+a+"</p></div>");$.ui.dialog.defaults.bgiframe=true;$(function(){$("#dialog").dialog({buttons:{Ok:function(){$(this).dialog("close")}},modal:true,draggable:false,resizable:false})})}function handle_header_message(a){if(a){$("#message_banner").html("<p>"+a+"</p>");$("#message_banner").show()}else{$("#message_banner").hide()}};